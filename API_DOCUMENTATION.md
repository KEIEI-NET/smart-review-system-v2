# Smart Review API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ v2.0

## ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [å¯¾è©±å¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹API](#å¯¾è©±å¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹api) ğŸ†•
3. [è¨­å®šç®¡ç†API](#è¨­å®šç®¡ç†api) ğŸ†•
4. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£API](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£api)
5. [ã‚³ã‚¢API](#ã‚³ã‚¢api)
6. [ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆAPI](#ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆapi)
7. [ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹](#ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹)
8. [ãƒ­ã‚®ãƒ³ã‚°ãƒ»ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°](#ãƒ­ã‚®ãƒ³ã‚°ãƒ»ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°)
9. [ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£API](#ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£api)
10. [ãƒ‡ãƒ¼ã‚¿æ§‹é€ ](#ãƒ‡ãƒ¼ã‚¿æ§‹é€ )
11. [ã‚¤ãƒ™ãƒ³ãƒˆ](#ã‚¤ãƒ™ãƒ³ãƒˆ)
12. [ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°](#ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°)
13. [ä½¿ç”¨ä¾‹](#ä½¿ç”¨ä¾‹)
14. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹)

## æ¦‚è¦

Smart Review API v2.0ã¯ã€åŒ…æ‹¬çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã‚’å‚™ãˆãŸæ¬¡ä¸–ä»£ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼è‡ªå‹•åŒ–ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚ã“ã®APIã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ã‚»ã‚­ãƒ¥ã‚¢ãªã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€è‡ªå‹•åŒ–ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã€ãŠã‚ˆã³ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ãƒãƒ¼ãƒˆã®ä½œæˆãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

### v2.0ã®ä¸»è¦æ©Ÿèƒ½

- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–**: åŒ…æ‹¬çš„ãªå…¥åŠ›æ¤œè¨¼ã€ã‚³ãƒãƒ³ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–ã€ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«é˜²æ­¢
- **ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹**: éš”é›¢ã•ã‚ŒãŸå®Ÿè¡Œç’°å¢ƒã§ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œ
- **ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æ©Ÿèƒ½**: ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãªçµæœã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚ˆã‚‹é«˜é€ŸåŒ–
- **æ§‹é€ åŒ–ãƒ­ã‚®ãƒ³ã‚°**: è©³ç´°ãªç›£æŸ»ãƒ­ã‚°ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆè¿½è·¡
- **ä¸¦åˆ—å®Ÿè¡Œ**: å„ªå…ˆåº¦ãƒ™ãƒ¼ã‚¹ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä¸¦åˆ—å®Ÿè¡Œ

### åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•

```javascript
const smartReview = require('./smart-review-v2');

// ã‚»ã‚­ãƒ¥ã‚¢ãªå®Ÿè¡Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ä½œæˆ
const context = {
  files: secureFileSystem,
  output: structuredLogger,
  terminal: sandboxedTerminal
};

// æ¤œè¨¼æ¸ˆã¿å¼•æ•°ã§ã®å®Ÿè¡Œ
const args = {
  scope: 'changes',
  target: './src',
  'priority-threshold': 'medium',
  'output-dir': './smart-review-results',
  'max-iterations': 3
};

// ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ¬ãƒ“ãƒ¥ãƒ¼ã®å®Ÿè¡Œ
const result = await smartReview.execute(context, args);
if (result.success) {
  console.log(`ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå®Œäº†: ${result.reportPath}`);
  console.log(`æ¤œå‡ºã•ã‚ŒãŸå•é¡Œ: ${result.context.metrics.issuesFound}`);
  console.log(`è‡ªå‹•ä¿®æ­£: ${result.context.metrics.issuesFixed}`);
}
```

## å¯¾è©±å¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹API ğŸ†•

### showHelp(output)

ãƒ˜ãƒ«ãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

```javascript
showHelp(output)
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `output` (Object): Claude Codeã®å‡ºåŠ›API

**å®Ÿè£…ä¾‹:**
```javascript
module.exports = {
  showHelp(output) {
    const helpText = `
ğŸ” Smart Review v2.0 - ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼è‡ªå‹•åŒ–ã‚·ã‚¹ãƒ†ãƒ 

ğŸ“– ä½¿ç”¨æ–¹æ³•:
  claude smart-review [ã‚ªãƒ—ã‚·ãƒ§ãƒ³]
  
ğŸ“‹ ã‚ªãƒ—ã‚·ãƒ§ãƒ³:
  --scope <changes|all>          ãƒã‚§ãƒƒã‚¯ç¯„å›²
  --target <ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª>         å¯¾è±¡ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
  --help                          ã“ã®ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º
  ...
`;
    output.info(helpText);
  }
}
```

### showInteractiveMenu(context)

å¯¾è©±å¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤ºã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é¸æŠã«åŸºã¥ã„ã¦é©åˆ‡ãªå‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```javascript
async showInteractiveMenu(context)
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `context` (Object): å®Ÿè¡Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
  - `input` (Object): å…¥åŠ›APIï¼ˆselect, text, number, confirmï¼‰
  - `output` (Object): å‡ºåŠ›API
  - `files` (Object): ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ API
  - `terminal` (Object): ã‚¿ãƒ¼ãƒŸãƒŠãƒ«API

**æˆ»ã‚Šå€¤:**
- `Promise<ReviewResult>`: ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœ

**ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚ªãƒ—ã‚·ãƒ§ãƒ³:**
```javascript
const menuOptions = [
  {
    name: 'ğŸ”„ å¤‰æ›´ç‚¹ã®ã‚¯ã‚¤ãƒƒã‚¯ãƒ¬ãƒ“ãƒ¥ãƒ¼',
    value: 'quick-changes',
    description: 'å‰å›ãƒã‚§ãƒƒã‚¯ä»¥é™ã®å¤‰æ›´ç‚¹ã‚’ç´ æ—©ããƒ¬ãƒ“ãƒ¥ãƒ¼'
  },
  {
    name: 'ğŸ” ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®ã‚¹ã‚­ãƒ£ãƒ³',
    value: 'full-scan',
    description: 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã‚’åŒ…æ‹¬çš„ã«ã‚¹ã‚­ãƒ£ãƒ³'
  },
  {
    name: 'ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»',
    value: 'security-audit',
    description: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ã«ç‰¹åŒ–ã—ãŸç›£æŸ»'
  },
  {
    name: 'âš¡ é«˜å„ªå…ˆåº¦å•é¡Œã®ã¿',
    value: 'high-priority',
    description: 'critical/highå„ªå…ˆåº¦ã®å•é¡Œã®ã¿ã‚’ãƒã‚§ãƒƒã‚¯'
  },
  {
    name: 'ğŸ¯ ã‚«ã‚¹ã‚¿ãƒ è¨­å®š',
    value: 'custom',
    description: 'è©³ç´°ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³è¨­å®šã§ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Ÿè¡Œ'
  },
  {
    name: 'ğŸ“– ãƒ˜ãƒ«ãƒ—è¡¨ç¤º',
    value: 'help',
    description: 'è©³ç´°ãªãƒ˜ãƒ«ãƒ—ã¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä¸€è¦§ã‚’è¡¨ç¤º'
  }
];
```

### showCustomMenu(context)

ã‚«ã‚¹ã‚¿ãƒ è¨­å®šãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤ºã—ã€è©³ç´°ãªè¨­å®šã‚’å¯¾è©±çš„ã«åé›†ã—ã¾ã™ã€‚

```javascript
async showCustomMenu(context)
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `context` (Object): å®Ÿè¡Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ

**æˆ»ã‚Šå€¤:**
- `Promise<ReviewResult>`: ã‚«ã‚¹ã‚¿ãƒ è¨­å®šã§ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœ

**åé›†ã•ã‚Œã‚‹è¨­å®š:**
1. `scope`: ãƒã‚§ãƒƒã‚¯ç¯„å›²ï¼ˆchanges/allï¼‰
2. `target`: å¯¾è±¡ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
3. `priorityThreshold`: å„ªå…ˆåº¦ã—ãã„å€¤
4. `maxIterations`: æœ€å¤§ç¹°ã‚Šè¿”ã—å›æ•°
5. `skipComment`: ã‚³ãƒ¡ãƒ³ãƒˆæ³¨é‡ˆã®ã‚¹ã‚­ãƒƒãƒ—
6. `outputDir`: å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

**å®Ÿè£…ä¾‹:**
```javascript
async showCustomMenu(context) {
  const { input, output } = context;
  
  try {
    // ãƒã‚§ãƒƒã‚¯ç¯„å›²ã®é¸æŠ
    const scope = await input.select('ãƒã‚§ãƒƒã‚¯ç¯„å›²:', [
      { name: 'å¤‰æ›´ç‚¹ã®ã¿ (changes)', value: 'changes' },
      { name: 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ (all)', value: 'all' }
    ]);
    
    // å¯¾è±¡ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å…¥åŠ›
    const target = await input.text('å¯¾è±¡ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª:', {
      default: '.',
      placeholder: 'ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å ´åˆã¯ . ã‚’å…¥åŠ›'
    });
    
    // å„ªå…ˆåº¦ã—ãã„å€¤ã®é¸æŠ
    const priorityThreshold = await input.select('å„ªå…ˆåº¦ã—ãã„å€¤:', [
      { name: 'é‡å¤§ãªå•é¡Œã®ã¿ (critical)', value: 'critical' },
      { name: 'é«˜å„ªå…ˆåº¦ä»¥ä¸Š (high)', value: 'high' },
      { name: 'ä¸­å„ªå…ˆåº¦ä»¥ä¸Š (medium)', value: 'medium' },
      { name: 'ã™ã¹ã¦ã®å•é¡Œ (low)', value: 'low' }
    ]);
    
    // ã‚«ã‚¹ã‚¿ãƒ è¨­å®šã§å®Ÿè¡Œ
    return await this.executeWithArgs(context, {
      scope,
      target,
      'priority-threshold': priorityThreshold,
      // ... ãã®ä»–ã®è¨­å®š
    });
    
  } catch (error) {
    output.error('ã‚«ã‚¹ã‚¿ãƒ è¨­å®šä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
    return { success: false, error: 'ã‚«ã‚¹ã‚¿ãƒ è¨­å®šã‚¨ãƒ©ãƒ¼' };
  }
}
```

### executeWithArgs(context, args)

æŒ‡å®šã•ã‚ŒãŸå¼•æ•°ã§ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å®Ÿè¡Œã—ã¾ã™ï¼ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼å‡¦ç†ã‚’ãƒã‚¤ãƒ‘ã‚¹ï¼‰ã€‚

```javascript
async executeWithArgs(context, args)
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `context` (Object): å®Ÿè¡Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
- `args` (Object): ãƒ¬ãƒ“ãƒ¥ãƒ¼å¼•æ•°
  - `_skipMenu` (boolean): å†…éƒ¨ãƒ•ãƒ©ã‚°ï¼ˆè‡ªå‹•è¨­å®šï¼‰

**æˆ»ã‚Šå€¤:**
- `Promise<ReviewResult>`: ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœ

### Claude Code Input API ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

å¯¾è©±å¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ä½¿ç”¨ã•ã‚Œã‚‹å…¥åŠ›APIãƒ¡ã‚½ãƒƒãƒ‰ï¼š

#### input.select(prompt, options)

é¸æŠè‚¢ã‹ã‚‰1ã¤ã‚’é¸æŠ

```javascript
const choice = await context.input.select('æ“ä½œã‚’é¸æŠ:', [
  { name: 'è¡¨ç¤ºå', value: 'å€¤', description: 'èª¬æ˜' }
]);
```

#### input.text(prompt, options)

ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã‚’å–å¾—

```javascript
const text = await context.input.text('ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª:', {
  default: '.',
  placeholder: 'ãƒ’ãƒ³ãƒˆãƒ†ã‚­ã‚¹ãƒˆ'
});
```

#### input.number(prompt, options)

æ•°å€¤å…¥åŠ›ã‚’å–å¾—

```javascript
const number = await context.input.number('ç¹°ã‚Šè¿”ã—å›æ•°:', {
  default: 5,
  min: 1,
  max: 10
});
```

#### input.confirm(prompt, options)

Yes/Noç¢ºèªã‚’å–å¾—

```javascript
const confirmed = await context.input.confirm('ç¶šè¡Œã—ã¾ã™ã‹?', {
  default: true
});
```

## è¨­å®šç®¡ç†API ğŸ†•

### SmartReviewConfig ã‚¯ãƒ©ã‚¹

**æ¦‚è¦**: ç’°å¢ƒå¤‰æ•°ã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®å„ªå…ˆé †ä½ã§è¨­å®šã‚’ä¸€å…ƒç®¡ç†ã™ã‚‹ã‚¯ãƒ©ã‚¹

#### ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿

```javascript
new SmartReviewConfig()
```

#### ãƒ¡ã‚½ãƒƒãƒ‰

##### getAgents()

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­å®šã®å–å¾—

```javascript
async getAgents()
```

**æˆ»ã‚Šå€¤**:
- `Promise<Array>`: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­å®šã®é…åˆ—

**ä¾‹**:
```javascript
const configManager = new SmartReviewConfig();
const agents = await configManager.getAgents();
agents.forEach(agent => {
  console.log(`${agent.name}: ${agent.enabled ? 'æœ‰åŠ¹' : 'ç„¡åŠ¹'}`);
});
```

##### getSecuritySettings()

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã®å–å¾—

```javascript
async getSecuritySettings()
```

**æˆ»ã‚Šå€¤**:
- `Promise<Object>`: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
  - `allowedPaths` (Array): è¨±å¯ã•ã‚ŒãŸãƒ‘ã‚¹
  - `blockedPatterns` (Array): ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³
  - `maxFileSize` (Number): æœ€å¤§ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º
  - `preventPathTraversal` (Boolean): ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«é˜²æ­¢
  - `sanitizeOutput` (Boolean): å‡ºåŠ›ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚º

##### getPerformanceSettings()

ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®šã®å–å¾—

```javascript
async getPerformanceSettings()
```

**æˆ»ã‚Šå€¤**:
- `Promise<Object>`: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
  - `maxConcurrency` (Number): æœ€å¤§ä¸¦åˆ—å®Ÿè¡Œæ•°
  - `cacheEnabled` (Boolean): ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰åŠ¹/ç„¡åŠ¹
  - `cacheTTL` (Number): ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰åŠ¹æœŸé™
  - `maxCacheSize` (Number): æœ€å¤§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µã‚¤ã‚º
  - `batchSize` (Number): ãƒãƒƒãƒã‚µã‚¤ã‚º

##### loadConfig()

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿

```javascript
async loadConfig()
```

**å„ªå…ˆé †ä½**:
1. ç’°å¢ƒå¤‰æ•° `SMART_REVIEW_CONFIG` ã§æŒ‡å®šã•ã‚ŒãŸãƒ‘ã‚¹
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã® `.smart-review.json`
3. ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã® `~/.claude/smart-review.json`
4. ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã® `~/.config/smart-review.json`
5. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š

**æˆ»ã‚Šå€¤**:
- `Promise<Object>`: ãƒãƒ¼ã‚¸ã•ã‚ŒãŸè¨­å®šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

##### createProjectConfig()

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

```javascript
async createProjectConfig(projectPath = process.cwd())
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `projectPath` (String): ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‘ã‚¹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰

**æˆ»ã‚Šå€¤**:
- `Promise<String>`: ä½œæˆã•ã‚ŒãŸè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹

**ä¾‹**:
```javascript
const configPath = await configManager.createProjectConfig();
console.log(`è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸ: ${configPath}`);
```

##### saveConfig()

è¨­å®šã®ä¿å­˜

```javascript
async saveConfig(config, targetPath = null)
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `config` (Object): ä¿å­˜ã™ã‚‹è¨­å®šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- `targetPath` (String): ä¿å­˜å…ˆãƒ‘ã‚¹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

**æˆ»ã‚Šå€¤**:
- `Promise<String>`: ä¿å­˜ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹

##### exportConfig()

è¨­å®šã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

```javascript
async exportConfig(format = 'json')
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `format` (String): ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå½¢å¼ï¼ˆ'json', 'env', 'yaml'ï¼‰

**æˆ»ã‚Šå€¤**:
- `Promise<String>`: ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿è¨­å®šæ–‡å­—åˆ—

**ä¾‹**:
```javascript
// JSONå½¢å¼ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
const jsonConfig = await configManager.exportConfig('json');

// ç’°å¢ƒå¤‰æ•°å½¢å¼ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
const envConfig = await configManager.exportConfig('env');
console.log(envConfig);
// SMART_REVIEW_ENABLED_AGENTS="security-analyzer,debugger"
// SMART_REVIEW_MAX_CONCURRENCY=4
// SMART_REVIEW_CACHE=true
```

### configManager ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹

**æ¦‚è¦**: ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«åˆ©ç”¨å¯èƒ½ãªè¨­å®šç®¡ç†ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹

```javascript
const { configManager } = require('./smart-review-config');

// è¨­å®šã®å–å¾—
const agents = await configManager.getAgents();
const security = await configManager.getSecuritySettings();
const performance = await configManager.getPerformanceSettings();
```

### ç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚‹è¨­å®š

ä»¥ä¸‹ã®ç’°å¢ƒå¤‰æ•°ã§è¨­å®šã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã§ãã¾ã™ï¼š

| ç’°å¢ƒå¤‰æ•° | èª¬æ˜ | ä¾‹ |
|---------|------|-----|
| `SMART_REVIEW_CONFIG` | è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ | `/path/to/config.json` |
| `SMART_REVIEW_DISABLED_AGENTS` | ç„¡åŠ¹åŒ–ã™ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆIDï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰ | `documentation-updater,reviewer` |
| `SMART_REVIEW_MAX_CONCURRENCY` | æœ€å¤§ä¸¦åˆ—å®Ÿè¡Œæ•° | `2` |
| `SMART_REVIEW_CACHE` | ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰åŠ¹/ç„¡åŠ¹ | `false` |
| `CLAUDE_AGENTS_PATH` | ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ | `~/.claude/agents` |

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£API

### Config ã‚¯ãƒ©ã‚¹

**æ¦‚è¦**: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã‚’ç®¡ç†ã™ã‚‹é™çš„è¨­å®šã‚¯ãƒ©ã‚¹

#### é™çš„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

##### ALLOWED_COMMANDS

å®Ÿè¡ŒãŒè¨±å¯ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ã®ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆ

```javascript
static get ALLOWED_COMMANDS() {
  return ['git', 'mkdir', 'claude'];
}
```

##### ALLOWED_OUTPUT_BASE

å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ™ãƒ¼ã‚¹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

```javascript
static get ALLOWED_OUTPUT_BASE() {
  return './smart-review-results';
}
```

##### MAX_ITERATIONS_RANGE

è¨±å¯ã•ã‚Œã‚‹æœ€å¤§åå¾©å›æ•°ã®ç¯„å›²

```javascript
static get MAX_ITERATIONS_RANGE() {
  return { min: 1, max: 10 };
}
```

### SecurityUtils ã‚¯ãƒ©ã‚¹

**æ¦‚è¦**: åŒ…æ‹¬çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’æä¾›ã™ã‚‹é™çš„ã‚¯ãƒ©ã‚¹

#### ãƒ¡ã‚½ãƒƒãƒ‰

##### validatePath()

åŒ…æ‹¬çš„ãªãƒ‘ã‚¹æ¤œè¨¼ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```javascript
static validatePath(userPath, baseDir = process.cwd())
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `userPath` (String): æ¤œè¨¼å¯¾è±¡ã®ãƒ‘ã‚¹
- `baseDir` (String): ãƒ™ãƒ¼ã‚¹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

**æˆ»ã‚Šå€¤**:
- `String`: æ¤œè¨¼æ¸ˆã¿ã®è§£æ±ºæ¸ˆã¿ãƒ‘ã‚¹

**ä¾‹å¤–**:
- ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«æ¤œå‡ºæ™‚: `Error`
- ä¸æ­£ãªãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºæ™‚: `Error`
- ãƒ‘ã‚¹é•·åˆ¶é™è¶…éæ™‚: `Error`

**ä¾‹**:

```javascript
try {
  const safePath = SecurityUtils.validatePath('../data/file.txt');
  console.log('å®‰å…¨ãªãƒ‘ã‚¹:', safePath);
} catch (error) {
  console.error('ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¨ãƒ©ãƒ¼:', error.message);
}
```

##### validateOutputDirectory()

å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ¤œè¨¼ã¨å®‰å…¨ãªç”Ÿæˆ

```javascript
static validateOutputDirectory(outputDir)
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `outputDir` (String): å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ‘ã‚¹

**æˆ»ã‚Šå€¤**:
- `String`: æ¤œè¨¼æ¸ˆã¿å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ‘ã‚¹

##### sanitizeError()

ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³

```javascript
static sanitizeError(error)
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `error` (Error): ã‚µãƒ‹ã‚¿ã‚¤ã‚ºå¯¾è±¡ã®ã‚¨ãƒ©ãƒ¼

**æˆ»ã‚Šå€¤**:
- `Object`: ã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆã¿ã‚¨ãƒ©ãƒ¼æƒ…å ±
  - `message` (String): ã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆã¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  - `code` (String): ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰
  - `timestamp` (String): ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
  - `sanitized` (Boolean): ã‚µãƒ‹ã‚¿ã‚¤ã‚ºãƒ•ãƒ©ã‚°

**ä¾‹**:

```javascript
try {
  // å±é™ºãªæ“ä½œ
  await dangerousOperation();
} catch (error) {
  const sanitized = SecurityUtils.sanitizeError(error);
  logger.error('å®‰å…¨ãªã‚¨ãƒ©ãƒ¼ãƒ­ã‚°', sanitized);
}
```

##### executeCommand()

ã‚»ã‚­ãƒ¥ã‚¢ãªã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ

```javascript
static async executeCommand(command, args = [], options = {})
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `command` (String): å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰ï¼ˆãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆå†…ï¼‰
- `args` (Array): ã‚³ãƒãƒ³ãƒ‰å¼•æ•°
- `options` (Object): å®Ÿè¡Œã‚ªãƒ—ã‚·ãƒ§ãƒ³
  - `timeout` (Number): ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“
  - `maxBuffer` (Number): æœ€å¤§ãƒãƒƒãƒ•ã‚¡ã‚µã‚¤ã‚º
  - `cwd` (String): ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

**æˆ»ã‚Šå€¤**:
- `Object`: å®Ÿè¡Œçµæœ
  - `stdout` (String): æ¨™æº–å‡ºåŠ›
  - `stderr` (String): æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›
  - `exitCode` (Number): çµ‚äº†ã‚³ãƒ¼ãƒ‰
  - `command` (String): å®Ÿè¡Œã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰
  - `args` (Array): ã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆã¿å¼•æ•°

**ä¾‹**:

```javascript
try {
  const result = await SecurityUtils.executeCommand('git', [
    'log',
    '--name-only',
    '--pretty=format:',
    '-n', '10'
  ]);
  
  console.log('Gitå‡ºåŠ›:', result.stdout);
} catch (error) {
  console.error('ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã‚¨ãƒ©ãƒ¼:', error.message);
}
```

### InputValidator ã‚¯ãƒ©ã‚¹

**æ¦‚è¦**: å…¥åŠ›å€¤ã®æ¤œè¨¼ã‚’è¡Œã†é™çš„ã‚¯ãƒ©ã‚¹

#### ãƒ¡ã‚½ãƒƒãƒ‰

##### validateString()

æ–‡å­—åˆ—ã®æ¤œè¨¼

```javascript
static validateString(input, options = {})
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `input` (String): æ¤œè¨¼å¯¾è±¡ã®æ–‡å­—åˆ—
- `options` (Object): æ¤œè¨¼ã‚ªãƒ—ã‚·ãƒ§ãƒ³
  - `maxLength` (Number): æœ€å¤§é•·ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 1000ï¼‰
  - `pattern` (RegExp): ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°
  - `allowEmpty` (Boolean): ç©ºæ–‡å­—è¨±å¯ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: falseï¼‰
  - `minLength` (Number): æœ€å°é•·ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0ï¼‰

**ä¾‹**:

```javascript
try {
  const validPath = InputValidator.validateString(userInput, {
    maxLength: 260,
    pattern: /^[a-zA-Z0-9._\/-]+$/,
    allowEmpty: false
  });
  console.log('æ¤œè¨¼æ¸ˆã¿ãƒ‘ã‚¹:', validPath);
} catch (error) {
  console.error('å…¥åŠ›æ¤œè¨¼ã‚¨ãƒ©ãƒ¼:', error.message);
}
```

##### validateNumber()

æ•°å€¤ã®æ¤œè¨¼

```javascript
static validateNumber(input, options = {})
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `input` (String|Number): æ¤œè¨¼å¯¾è±¡ã®æ•°å€¤
- `options` (Object): æ¤œè¨¼ã‚ªãƒ—ã‚·ãƒ§ãƒ³
  - `min` (Number): æœ€å°å€¤
  - `max` (Number): æœ€å¤§å€¤
  - `integer` (Boolean): æ•´æ•°é™å®š

**ä¾‹**:

```javascript
const maxIterations = InputValidator.validateNumber(args.maxIterations, {
  min: 1,
  max: 10,
  integer: true
});
```

##### validateChoice()

é¸æŠè‚¢ã®æ¤œè¨¼

```javascript
static validateChoice(input, choices)
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `input` (String): æ¤œè¨¼å¯¾è±¡ã®å€¤
- `choices` (Array): æœ‰åŠ¹ãªé¸æŠè‚¢

**ä¾‹**:

```javascript
const scope = InputValidator.validateChoice(args.scope, ['changes', 'all']);
```

### AgentSandbox ã‚¯ãƒ©ã‚¹

**æ¦‚è¦**: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’éš”é›¢ã•ã‚ŒãŸç’°å¢ƒã§å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã‚¯ãƒ©ã‚¹

#### ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿

```javascript
new AgentSandbox(agent, context)
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `agent` (Object): ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®šç¾©
- `context` (Object): å®Ÿè¡Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ

#### ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

- `timeout` (Number): å®Ÿè¡Œã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
- `maxMemory` (Number): æœ€å¤§ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
- `allowedOperations` (Array): è¨±å¯ã•ã‚ŒãŸæ“ä½œ

#### ãƒ¡ã‚½ãƒƒãƒ‰

##### execute()

ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹å†…ã§ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œ

```javascript
async execute(files, iteration = 1)
```

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½**:
- ãƒ—ãƒ­ã‚»ã‚¹éš”é›¢
- ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆåˆ¶å¾¡
- èª­ã¿å–ã‚Šå°‚ç”¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ 
- åˆ¶é™ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `files` (Array<String>): æ¤œè¨¼æ¸ˆã¿åˆ†æå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- `iteration` (Number): åå¾©ç•ªå·

**æˆ»ã‚Šå€¤**:
- `Object`: å®Ÿè¡Œçµæœ
  - `agentId` (String): ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆID
  - `agentName` (String): ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå
  - `issues` (Array): æ¤œå‡ºã•ã‚ŒãŸå•é¡Œ
  - `rawOutput` (String): ç”Ÿã®å‡ºåŠ›
  - `executionTime` (Number): å®Ÿè¡Œæ™‚é–“
  - `sandboxId` (String): ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ID
  - `error` (String): ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ï¼‰

**ä¾‹**:

```javascript
const sandbox = new AgentSandbox(securityAgent, context);
try {
  const result = await sandbox.execute(['file1.js', 'file2.ts'], 1);
  console.log(`${result.agentName}: ${result.issues.length}å€‹ã®å•é¡Œã‚’æ¤œå‡º`);
} catch (error) {
  console.error('ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹å®Ÿè¡Œã‚¨ãƒ©ãƒ¼:', error.message);
}
```

## ã‚³ã‚¢API

### smart-review-v2 ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

ãƒ¡ã‚¤ãƒ³ã®ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒãƒ³ãƒ‰ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã™ã€‚

#### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹é€ 

```javascript
module.exports = {
  name: 'smart-review',
  description: 'å¤‰æ›´ç‚¹ã¾ãŸã¯å…¨ä½“ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€ä¿®æ­£ã¾ãŸã¯TODOãƒªã‚¹ãƒˆã‚’ç”Ÿæˆï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ç‰ˆï¼‰',
  options: [...], // ã‚³ãƒãƒ³ãƒ‰ã‚ªãƒ—ã‚·ãƒ§ãƒ³å®šç¾©
  async execute(context, args) { ... } // ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œé–¢æ•°
}
```

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³å®šç¾©

**åˆ©ç”¨å¯èƒ½ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³:**
- `scope` (choice): 'changes' ã¾ãŸã¯ 'all' - ãƒã‚§ãƒƒã‚¯ç¯„å›²
- `target` (string): å¯¾è±¡ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: '.'ï¼‰
- `todo-file` (string): æ—¢å­˜ã®TODOãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
- `max-iterations` (number): æœ€å¤§ç¹°ã‚Šè¿”ã—å›æ•°ï¼ˆ1-10ï¼‰
- `output-dir` (string): çµæœã®å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
- `skip-comment` (boolean): ã‚³ãƒ¡ãƒ³ãƒˆæ³¨é‡ˆã‚’ã‚¹ã‚­ãƒƒãƒ—
- `priority-threshold` (choice): TODOã«å«ã‚ã‚‹æœ€å°å„ªå…ˆåº¦

#### å®Ÿè¡Œé–¢æ•°

##### execute()

ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```javascript
async execute(context, args)
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `context` (Object): å®Ÿè¡Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
  - `files` (Object): ã‚»ã‚­ãƒ¥ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ API
  - `output` (Object): æ§‹é€ åŒ–å‡ºåŠ›API
  - `terminal` (Object): ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹åŒ–ã‚¿ãƒ¼ãƒŸãƒŠãƒ«API
- `args` (Object): æ¤œè¨¼æ¸ˆã¿ã‚³ãƒãƒ³ãƒ‰å¼•æ•°
  - ã™ã¹ã¦ã®å¼•æ•°ã¯äº‹å‰ã«æ¤œè¨¼ãƒ»ã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆã¿

**æˆ»ã‚Šå€¤**:
- `Promise<ReviewResult>`: ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœ

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½**:
- å…¥åŠ›æ¤œè¨¼ã¨ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
- ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«é˜²æ­¢
- ã‚³ãƒãƒ³ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–
- ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™ã®é©ç”¨
- æ§‹é€ åŒ–ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**ä¾‹**:

```javascript
const result = await smartReviewV2.execute({
  files: secureFileSystem,
  output: structuredLogger,
  terminal: sandboxedTerminal
}, {
  scope: 'changes',
  target: './src',
  'priority-threshold': 'high',
  'max-iterations': 3
});

if (result.success) {
  console.log('ã‚»ã‚­ãƒ¥ã‚¢ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†:', result.reportPath);
  console.log('ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¡ãƒˆãƒªã‚¯ã‚¹:', result.context.metrics);
} else {
  console.error('ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒ©ãƒ¼:', result.error);
}
```

##### å†…éƒ¨ã‚»ã‚­ãƒ¥ã‚¢é–¢æ•°

**detectChangedFiles()** (å†…éƒ¨é–¢æ•°)

ã‚»ã‚­ãƒ¥ã‚¢ãªGitæ“ä½œã«ã‚ˆã‚‹å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«æ¤œå‡º

```javascript
async function detectChangedFiles()
```

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½**:
- ã‚»ã‚­ãƒ¥ã‚¢ãªGitã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
- å‡ºåŠ›ã‚µã‚¤ã‚ºåˆ¶é™
- ãƒ‘ã‚¹é•·åˆ¶é™
- é‡è¤‡é™¤å»
- ã‚¨ãƒ©ãƒ¼æ™‚ã®å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

**æˆ»ã‚Šå€¤**:
- `Array<String>`: æ¤œè¨¼æ¸ˆã¿å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹é…åˆ—

**ParallelExecutor.executeAgents()** (å†…éƒ¨ã‚¯ãƒ©ã‚¹)

å„ªå…ˆåº¦ãƒ™ãƒ¼ã‚¹ã®ä¸¦åˆ—ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œ

```javascript
static async executeAgents(agents, files, context, iteration = 1)
```

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½**:
- åŒæ™‚å®Ÿè¡Œæ•°åˆ¶é™ï¼ˆãƒªã‚½ãƒ¼ã‚¹æ¯æ¸‡é˜²æ­¢ï¼‰
- å„ªå…ˆåº¦ãƒ™ãƒ¼ã‚¹ã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã‚µã‚¤ã‚ºåˆ¶é™
- ã‚¨ãƒ©ãƒ¼éš”é›¢ã¨å›å¾©
- ãƒªã‚½ãƒ¼ã‚¹æ¯æ¸‡é˜²æ­¢

**å®Ÿè¡Œé †åº**:
1. Criticalå„ªå…ˆåº¦ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆé †æ¬¡å®Ÿè¡Œï¼‰
2. Highå„ªå…ˆåº¦ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆä¸¦åˆ—å®Ÿè¡Œï¼‰
3. Mediumå„ªå…ˆåº¦ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆä¸¦åˆ—å®Ÿè¡Œï¼‰
4. Lowå„ªå…ˆåº¦ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆä¸¦åˆ—å®Ÿè¡Œï¼‰

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `agents` (Array): ã‚»ã‚­ãƒ¥ã‚¢æ¤œè¨¼æ¸ˆã¿ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
- `files` (Array): æ¤œè¨¼æ¸ˆã¿åˆ†æå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- `context` (SecureContext): ã‚»ã‚­ãƒ¥ã‚¢å®Ÿè¡Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
- `iteration` (Number): åå¾©ç•ªå·

**æˆ»ã‚Šå€¤**:
- `Array<AgentResult>`: ã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆã¿å®Ÿè¡Œçµæœ

## ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

### ResultCache ã‚¯ãƒ©ã‚¹

**æ¦‚è¦**: ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãªçµæœã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ 

#### ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿

```javascript
new ResultCache()
```

#### ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

- `ttl` (Number): ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰åŠ¹æœŸé™ï¼ˆ15åˆ†ï¼‰
- `maxSize` (Number): æœ€å¤§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µã‚¤ã‚ºï¼ˆ100ã‚¨ãƒ³ãƒˆãƒªï¼‰

#### ãƒ¡ã‚½ãƒƒãƒ‰

##### hashFile()

ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒã‚·ãƒ¥ã®ç”Ÿæˆ

```javascript
async hashFile(filePath)
```

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½**:
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™ï¼ˆ10MBï¼‰
- SHA-256ãƒãƒƒã‚·ãƒ¥ä½¿ç”¨
- ã‚¨ãƒ©ãƒ¼æ™‚ã®å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `filePath` (String): ãƒãƒƒã‚·ãƒ¥å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«

**æˆ»ã‚Šå€¤**:
- `String`: SHA-256ãƒãƒƒã‚·ãƒ¥å€¤

##### getCacheKey()

ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ã®ç”Ÿæˆ

```javascript
async getCacheKey(agent, files, iteration = 1)
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `agent` (Object): ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®šç¾©
- `files` (Array): å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- `iteration` (Number): åå¾©ç•ªå·

**æˆ»ã‚Šå€¤**:
- `String`: ä¸€æ„ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼

##### get()

ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰ã®å–å¾—

```javascript
async get(agent, files, iteration = 1)
```

**æˆ»ã‚Šå€¤**:
- `Object|null`: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸçµæœã¾ãŸã¯null

##### set()

ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¸ã®ä¿å­˜

```javascript
async set(agent, files, iteration, result)
```

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½**:
- ãƒ‡ã‚£ãƒ¼ãƒ—ã‚³ãƒ”ãƒ¼ã«ã‚ˆã‚‹å‚ç…§ãƒªãƒ¼ã‚¯é˜²æ­¢
- ã‚µã‚¤ã‚ºåˆ¶é™ã®é©ç”¨
- è‡ªå‹•çš„ãªå¤ã„ã‚¨ãƒ³ãƒˆãƒªã®å‰Šé™¤

**ä¾‹**:

```javascript
const cache = new ResultCache();

// ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç¢ºèª
const cached = await cache.get(agent, files, 1);
if (cached) {
  console.log('ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆ:', cached.issues.length);
  return cached;
}

// ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œ
const result = await executeAgent(agent, files);

// çµæœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
await cache.set(agent, files, 1, result);
```

## ãƒ­ã‚®ãƒ³ã‚°ãƒ»ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

### StructuredLogger ã‚¯ãƒ©ã‚¹

**æ¦‚è¦**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾å¿œã®æ§‹é€ åŒ–ãƒ­ã‚®ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ 

#### ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿

```javascript
new StructuredLogger()
```

#### ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

- `context` (Object): ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
  - `sessionId` (String): ä¸€æ„ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³è­˜åˆ¥å­
  - `version` (String): ã‚·ã‚¹ãƒ†ãƒ ãƒãƒ¼ã‚¸ãƒ§ãƒ³
  - `startTime` (String): é–‹å§‹æ™‚åˆ»

#### ãƒ¡ã‚½ãƒƒãƒ‰

##### log()

åŸºæœ¬ãƒ­ã‚°å‡ºåŠ›

```javascript
log(level, message, metadata = {})
```

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½**:
- è‡ªå‹•çš„ãªHTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
- æ©Ÿå¯†æƒ…å ±ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
- JSONå½¢å¼ã§ã®æ§‹é€ åŒ–å‡ºåŠ›

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `level` (String): ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«
- `message` (String): ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- `metadata` (Object): è¿½åŠ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿

##### error()

ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°å‡ºåŠ›

```javascript
error(message, error = null, metadata = {})
```

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½**:
- ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
- ã‚¨ãƒ©ãƒ¼è©³ç´°ã®å®‰å…¨ãªè¨˜éŒ²

##### security()

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°

```javascript
security(event, details = {})
```

**ä¾‹**:

```javascript
const logger = new StructuredLogger();

// ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã®è¨˜éŒ²
logger.security('COMMAND_INJECTION_ATTEMPT', {
  command: sanitized.command,
  source: 'user-input',
  blocked: true
});

// ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œãƒ­ã‚°
logger.agent('SecurityAnalyzer', 'execution_completed', {
  issuesFound: 5,
  executionTime: 1200,
  filesAnalyzed: 15
});

// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹
logger.performance('agent_execution', 1200, {
  agentType: 'security',
  fileCount: 15
});
```

## ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆAPI

### Agent å®šç¾©æ§‹é€ 

v2.0ã§ã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã•ã‚ŒãŸã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®šç¾©ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

#### ã‚»ã‚­ãƒ¥ã‚¢ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ§‹é€ 

```javascript
{
  id: String,                    // ä¸€æ„ã®è­˜åˆ¥å­
  name: String,                  // è¡¨ç¤ºå
  model: String,                 // AIãƒ¢ãƒ‡ãƒ«ï¼ˆ'sonnet' | 'opus'ï¼‰
  path: String,                  // æ¤œè¨¼æ¸ˆã¿ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œãƒ‘ã‚¹
  role: String,                  // ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å½¹å‰²
  category: String,              // ã‚«ãƒ†ã‚´ãƒªï¼ˆ'security' | 'bug' | 'quality' | 'documentation'ï¼‰
  errorTypes: Array,             // æ¤œå‡ºå¯èƒ½ãªã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—
  canAutoFix: Boolean,           // è‡ªå‹•ä¿®æ­£èƒ½åŠ›
  priority: String,              // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå„ªå…ˆåº¦
  allowedCommands: Array         // è¨±å¯ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ï¼ˆã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ç”¨ï¼‰
}
```

#### äº‹å‰å®šç¾©ã•ã‚ŒãŸã‚»ã‚­ãƒ¥ã‚¢ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ**
```javascript
{
  id: 'security-error-xss-analyzer',
  name: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»XSSã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼',
  model: 'sonnet',
  role: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ã®æ¤œå‡º',
  category: 'security',
  errorTypes: ['xss', 'sql-injection', 'csrf', 'auth-bypass', 'data-exposure'],
  canAutoFix: true,
  priority: 'critical',
  allowedCommands: ['git']
}
```

**ãƒã‚°æ¤œå‡ºã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ**
```javascript
{
  id: 'super-debugger-perfectionist',
  name: 'ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ‡ãƒãƒƒã‚¬ãƒ¼ï¼ˆå®Œç’§ä¸»ç¾©è€…ï¼‰',
  model: 'sonnet',
  role: 'ãƒã‚°ã¨æœ€é©åŒ–ãƒã‚¤ãƒ³ãƒˆã®æ¤œå‡º',
  category: 'bug',
  errorTypes: ['bug', 'logic-error', 'memory-leak', 'performance', 'race-condition'],
  canAutoFix: true,
  priority: 'high',
  allowedCommands: ['git']
}
```

**ã‚³ãƒ¼ãƒ‰å“è³ªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ**
```javascript
{
  id: 'deep-code-reviewer',
  name: 'ãƒ‡ã‚£ãƒ¼ãƒ—ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼',
  model: 'opus',
  role: 'ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã‚³ãƒ¼ãƒ‰å“è³ªã®è©•ä¾¡',
  category: 'quality',
  errorTypes: ['architecture', 'design-pattern', 'code-smell', 'complexity', 'duplication'],
  canAutoFix: false,
  priority: 'medium',
  allowedCommands: ['git']
}
```

#### ã‚»ã‚­ãƒ¥ã‚¢ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œ

```javascript
// AgentSandboxã«ã‚ˆã‚‹éš”é›¢å®Ÿè¡Œ
const sandbox = new AgentSandbox(agent, secureContext);
const result = await sandbox.execute(targetFiles, iteration);

// çµæœã¯è‡ªå‹•çš„ã«ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã•ã‚Œã¾ã™
console.log('å®‰å…¨ãªçµæœ:', {
  agentId: result.agentId,
  issuesFound: result.issues.length,
  executionTime: result.executionTime,
  sandboxId: result.sandboxId
});
```

#### ã‚»ã‚­ãƒ¥ã‚¢ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œãƒ¡ã‚½ãƒƒãƒ‰

##### AgentSandbox.execute()

ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹åŒ–ã•ã‚ŒãŸã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œ

```javascript
async execute(files, iteration = 1)
```

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½**:
- ãƒ—ãƒ­ã‚»ã‚¹éš”é›¢
- ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆåˆ¶å¾¡
- èª­ã¿å–ã‚Šå°‚ç”¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ 
- åˆ¶é™ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `files` (Array<String>): æ¤œè¨¼æ¸ˆã¿åˆ†æå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- `iteration` (Number): åå¾©ç•ªå·

**æˆ»ã‚Šå€¤**:
- `Promise<SanitizedAgentResult>`: ã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆã¿ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œçµæœ

##### AgentSandbox.parseAgentOutput()

ã‚»ã‚­ãƒ¥ã‚¢ãªå‡ºåŠ›è§£æ

```javascript
parseAgentOutput(output)
```

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½**:
- å…¥åŠ›ã‚µã‚¤ã‚ºåˆ¶é™ï¼ˆ1MBï¼‰
- ReDoSæ”»æ’ƒå¯¾ç­–
- HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
- å•é¡Œæ•°åˆ¶é™ï¼ˆ1000å€‹ï¼‰
- ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°åˆ¶é™

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `output` (String): ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ç”Ÿã®å‡ºåŠ›

**æˆ»ã‚Šå€¤**:
- `Array<SanitizedIssue>`: ã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆã¿å•é¡Œé…åˆ—

### ParallelExecutor ã‚¯ãƒ©ã‚¹

ã‚»ã‚­ãƒ¥ã‚¢ãªä¸¦åˆ—ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œç®¡ç†

#### é™çš„ãƒ¡ã‚½ãƒƒãƒ‰

##### executeAgents()

å„ªå…ˆåº¦ãƒ™ãƒ¼ã‚¹ã®å®‰å…¨ãªä¸¦åˆ—å®Ÿè¡Œ

```javascript
static async executeAgents(agents, files, context, iteration = 1)
```

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½**:
- åŒæ™‚å®Ÿè¡Œæ•°åˆ¶é™ï¼ˆæœ€å¤§4ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼‰
- å„ªå…ˆåº¦ãƒ™ãƒ¼ã‚¹ã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã‚µã‚¤ã‚ºåˆ¶é™
- ã‚¨ãƒ©ãƒ¼éš”é›¢ã¨å›å¾©
- ãƒªã‚½ãƒ¼ã‚¹æ¯æ¸‡é˜²æ­¢

**å®Ÿè¡Œé †åº**:
1. Criticalå„ªå…ˆåº¦ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆé †æ¬¡å®Ÿè¡Œï¼‰
2. Highå„ªå…ˆåº¦ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆä¸¦åˆ—å®Ÿè¡Œï¼‰
3. Mediumå„ªå…ˆåº¦ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆä¸¦åˆ—å®Ÿè¡Œï¼‰
4. Lowå„ªå…ˆåº¦ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆä¸¦åˆ—å®Ÿè¡Œï¼‰

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `agents` (Array<SecureAgent>): ã‚»ã‚­ãƒ¥ã‚¢æ¤œè¨¼æ¸ˆã¿ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
- `files` (Array<String>): æ¤œè¨¼æ¸ˆã¿åˆ†æå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- `context` (SecureContext): ã‚»ã‚­ãƒ¥ã‚¢å®Ÿè¡Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
- `iteration` (Number): åå¾©ç•ªå·

**æˆ»ã‚Šå€¤**:
- `Promise<Array<SanitizedAgentResult>>`: ã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆã¿å®Ÿè¡Œçµæœ

##### groupByPriority()

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å„ªå…ˆåº¦åˆ¥ã‚°ãƒ«ãƒ¼ãƒ—åŒ–

```javascript
static groupByPriority(agents)
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `agents` (Array): ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé…åˆ—

**æˆ»ã‚Šå€¤**:
- `Array<Array>`: å„ªå…ˆåº¦åˆ¥ã‚°ãƒ«ãƒ¼ãƒ—é…åˆ—

**ä¾‹**:

```javascript
// ã‚»ã‚­ãƒ¥ã‚¢ãªä¸¦åˆ—å®Ÿè¡Œ
const results = await ParallelExecutor.executeAgents(
  secureAgents,
  validatedFiles,
  secureContext,
  1
);

// çµæœã®å‡¦ç†ï¼ˆå…¨ã¦è‡ªå‹•çš„ã«ã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆã¿ï¼‰
results.forEach(result => {
  if (result.error) {
    logger.security('AGENT_EXECUTION_FAILURE', {
      agentId: result.agentId,
      error: result.error
    });
  } else {
    logger.info(`${result.agentName}: ${result.issues.length}å•é¡Œæ¤œå‡º`);
  }
});
```

## ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£API

### ã‚»ã‚­ãƒ¥ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ï¼ˆå†…éƒ¨å®Ÿè£…ï¼‰

v2.0ã§ã¯ã€ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œãŒã‚»ã‚­ãƒ¥ã‚¢åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚

#### ã‚»ã‚­ãƒ¥ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ

**createReadOnlyFileSystem()** (AgentSandboxå†…)

èª­ã¿å–ã‚Šå°‚ç”¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®ä½œæˆ

```javascript
createReadOnlyFileSystem(files)
```

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½**:
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ï¼ˆãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆï¼‰
- ãƒ‘ã‚¹æ¤œè¨¼
- æ›¸ãè¾¼ã¿æ“ä½œã®å®Œå…¨ç„¡åŠ¹åŒ–
- ã‚¨ãƒ©ãƒ¼ã®å®‰å…¨ãªå‡¦ç†

**æä¾›ãƒ¡ã‚½ãƒƒãƒ‰**:
- `read(filePath)`: ã‚»ã‚­ãƒ¥ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿å–ã‚Š
- `exists(filePath)`: ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ç¢ºèª
- `write()`: å¸¸ã«ä¾‹å¤–ï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ï¼‰

**ä¾‹**:

```javascript
// ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹å†…ã§ã®ã‚»ã‚­ãƒ¥ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹
const readOnlyFS = sandbox.createReadOnlyFileSystem(allowedFiles);

try {
  const content = await readOnlyFS.read('/safe/path/file.js');
  console.log('ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹å–å¾—æˆåŠŸ');
} catch (error) {
  // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¨ãƒ©ãƒ¼ã¾ãŸã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼
  logger.security('FILE_ACCESS_DENIED', {
    path: '/safe/path/file.js',
    error: error.message
  });
}

// æ›¸ãè¾¼ã¿è©¦è¡Œã¯å¸¸ã«å¤±æ•—
try {
  await readOnlyFS.write('/any/path', 'content');
} catch (error) {
  console.log('æœŸå¾…é€šã‚Šæ›¸ãè¾¼ã¿æ‹’å¦:', error.message);
}
```

### ã‚»ã‚­ãƒ¥ã‚¢Gitæ“ä½œï¼ˆå†…éƒ¨å®Ÿè£…ï¼‰

v2.0ã§ã¯ã€ã™ã¹ã¦ã®Gitæ“ä½œãŒã‚»ã‚­ãƒ¥ã‚¢åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚

#### SecurityUtils.executeCommand()ã‚’ä½¿ç”¨ã—ãŸGitæ“ä½œ

**ã‚»ã‚­ãƒ¥ã‚¢Gitã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ**

```javascript
// ã‚»ã‚­ãƒ¥ã‚¢ãªå¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«æ¤œå‡º
const gitArgs = ['log', '--name-only', '--pretty=format:', '--after', timeString];
const result = await SecurityUtils.executeCommand('git', gitArgs);
```

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½**:
- ã‚³ãƒãƒ³ãƒ‰ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆï¼ˆ'git'ã®ã¿è¨±å¯ï¼‰
- å¼•æ•°ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
- ã‚·ã‚§ãƒ«è§£é‡ˆç„¡åŠ¹åŒ–
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆåˆ¶å¾¡
- ãƒãƒƒãƒ•ã‚¡ã‚µã‚¤ã‚ºåˆ¶é™
- ç’°å¢ƒå¤‰æ•°ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³

**å®‰å…¨ãªæ—¥ä»˜å‡¦ç†**:

```javascript
// SecurityUtils.safeParseDate()ã«ã‚ˆã‚‹å®‰å…¨ãªæ—¥ä»˜è§£æ
const lastCheckTime = SecurityUtils.safeParseDate(timeMatch[1]);

// ISO 8601å½¢å¼ã®æ¤œè¨¼
// ä¸æ­£ãªæ—¥ä»˜å½¢å¼ã‚’è‡ªå‹•çš„ã«æ‹’å¦
// nullãƒã‚§ãƒƒã‚¯ã«ã‚ˆã‚‹å®‰å…¨ãªå‡¦ç†
```

**å‡ºåŠ›ã‚µã‚¤ã‚ºåˆ¶é™**:

```javascript
// Gitå‡ºåŠ›ã®åˆ¶é™ï¼ˆãƒ¡ãƒ¢ãƒªæ”»æ’ƒé˜²æ­¢ï¼‰
const limitedOutput = result.stdout.length > 1024 * 1024 
  ? result.stdout.substring(0, 1024 * 1024) 
  : result.stdout;

// ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹é•·åˆ¶é™
const changedFiles = limitedOutput
  .split('\n')
  .filter(f => f.length < 260) // Windows PATHåˆ¶é™
  .slice(0, 1000); // ãƒ•ã‚¡ã‚¤ãƒ«æ•°åˆ¶é™
```

### ã‚»ã‚­ãƒ¥ã‚¢ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆï¼ˆå†…éƒ¨å®Ÿè£…ï¼‰

v2.0ã§ã¯ã€XSSå¯¾ç­–ã‚’å«ã‚€å®Œå…¨ã«ã‚»ã‚­ãƒ¥ã‚¢åŒ–ã•ã‚ŒãŸãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

#### generateHTMLReport() (å†…éƒ¨é–¢æ•°)

XSSæ”»æ’ƒå¯¾ç­–æ¸ˆã¿HTMLãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

```javascript
function generateHTMLReport(context)
```

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½**:
- å…¨ãƒ‡ãƒ¼ã‚¿ã®HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
- CSPï¼ˆContent Security Policyï¼‰å¯¾å¿œ
- ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ CSS/JSç„¡åŠ¹åŒ–
- ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®å®Œå…¨ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³

**XSSå¯¾ç­–ä¾‹**:

```javascript
// å…¨ã¦ã®å‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
<title>Smart Review Report - ${SecurityUtils.escapeHtml(new Date().toISOString())}</title>

// å•é¡Œãƒ‡ãƒ¼ã‚¿ã®ã‚»ã‚­ãƒ¥ã‚¢è¡¨ç¤º
<div class="issue-title">${SecurityUtils.escapeHtml(item.title)}</div>
<div class="issue-meta">
  ${item.file ? `ğŸ“ ${SecurityUtils.escapeHtml(item.file)}${item.line ? `:${item.line}` : ''}` : ''}
</div>
```

#### generateTodoContent() (å†…éƒ¨é–¢æ•°)

ã‚»ã‚­ãƒ¥ã‚¢åŒ–ã•ã‚ŒãŸTODOç”Ÿæˆ

```javascript
function generateTodoContent(issues, priorityThreshold, previousTodo = '')
```

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½**:
- å„ªå…ˆåº¦ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†
- ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
- çµ±è¨ˆæƒ…å ±ã®å®‰å…¨ãªè¡¨ç¤º

**ã‚»ã‚­ãƒ¥ã‚¢çµ±è¨ˆç”Ÿæˆ**:

```javascript
// ã‚»ã‚­ãƒ¥ã‚¢ãªçµ±è¨ˆæƒ…å ±
todoContent += `å¯¾è±¡: ${SecurityUtils.escapeHtml(target)}\n`;
todoContent += `æ¤œå‡ºã•ã‚ŒãŸå•é¡Œ: ${filteredIssues.length}ä»¶\n\n`;

// å„TODOé …ç›®ã®ã‚»ã‚­ãƒ¥ã‚¢è¡¨ç¤º
todoContent += `${index + 1}. [ ] ${SecurityUtils.escapeHtml(todoItem.title)}\n`;
if (todoItem.file) {
  todoContent += `   - ãƒ•ã‚¡ã‚¤ãƒ«: ${SecurityUtils.escapeHtml(todoItem.file)}`;
}
```

## ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### ReviewResult (v2.0å¼·åŒ–ç‰ˆ)

```typescript
interface ReviewResult {
  success: boolean;                    // å®Ÿè¡ŒæˆåŠŸãƒ•ãƒ©ã‚°
  context?: SecureExecutionContext;    // ã‚»ã‚­ãƒ¥ã‚¢å®Ÿè¡Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
  reportPath?: string;                 // æ¤œè¨¼æ¸ˆã¿ãƒ¬ãƒãƒ¼ãƒˆãƒ‘ã‚¹
  outputDir?: string;                  // ã‚»ã‚­ãƒ¥ã‚¢å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
  error?: string;                      // ã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆã¿ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  message?: string;                    // ã‚»ã‚­ãƒ¥ã‚¢çŠ¶æ…‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
}
```

### SecureExecutionContext (v2.0)

```typescript
interface SecureExecutionContext {
  scope: 'changes' | 'all';                      // æ¤œè¨¼æ¸ˆã¿ã‚¹ã‚³ãƒ¼ãƒ—
  target: string;                                 // æ¤œè¨¼æ¸ˆã¿ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ‘ã‚¹
  startTime: string;                              // ISO8601ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
  changedFiles: string[];                         // æ¤œè¨¼æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹é…åˆ—
  allIssues: SanitizedIssue[];                   // ã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆã¿å•é¡Œé…åˆ—
  todoList: SecureTodoItem[];                     // ã‚»ã‚­ãƒ¥ã‚¢TODOé …ç›®
  iterations: SecureIterationResult[];           // ã‚»ã‚­ãƒ¥ã‚¢åå¾©çµæœ
  finalCommentResult: SecureCommentResult | null; // ã‚»ã‚­ãƒ¥ã‚¢ã‚³ãƒ¡ãƒ³ãƒˆçµæœ
  metrics: SecureMetrics;                         // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¡ãƒˆãƒªã‚¯ã‚¹
}
```

### SanitizedIssue (v2.0)

```typescript
interface SanitizedIssue {
  level: 'error' | 'warning' | 'info' | 'suggestion';  // æ¤œè¨¼æ¸ˆã¿ãƒ¬ãƒ™ãƒ«
  message: string;                                      // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æ¸ˆã¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  file?: string;                                        // ã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
  line?: number;                                        // æ¤œè¨¼æ¸ˆã¿è¡Œç•ªå·ï¼ˆ1-1000000ï¼‰
  type: string;                                         // æ¤œè¨¼æ¸ˆã¿ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—
  category: 'security' | 'bug' | 'quality' | 'documentation'; // æ¤œè¨¼æ¸ˆã¿ã‚«ãƒ†ã‚´ãƒª
  priority: 'critical' | 'high' | 'medium' | 'low';   // æ¤œè¨¼æ¸ˆã¿å„ªå…ˆåº¦
  agentId: string;                                      // ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æ¸ˆã¿ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆID
  autoFixAvailable: boolean;                            // è‡ªå‹•ä¿®æ­£å¯èƒ½ãƒ•ãƒ©ã‚°
}
```

### SecureTodoItem (v2.0)

```typescript
interface SecureTodoItem {
  priority: 'critical' | 'high' | 'medium' | 'low';  // æ¤œè¨¼æ¸ˆã¿å„ªå…ˆåº¦
  category: string;                                   // ã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆã¿ã‚«ãƒ†ã‚´ãƒª
  type: string;                                       // æ¤œè¨¼æ¸ˆã¿ã‚¿ã‚¤ãƒ—
  title: string;                                      // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æ¸ˆã¿ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆ100æ–‡å­—åˆ¶é™ï¼‰
  description: string;                                // ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æ¸ˆã¿èª¬æ˜
  file?: string;                                      // ã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
  line?: number;                                      // æ¤œè¨¼æ¸ˆã¿è¡Œç•ªå·
  autoFixAvailable: boolean;                          // è‡ªå‹•ä¿®æ­£å¯èƒ½ãƒ•ãƒ©ã‚°
}
```

### SanitizedAgentResult (v2.0)

```typescript
interface SanitizedAgentResult {
  agentId: string;                          // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æ¸ˆã¿ID
  agentName: string;                        // ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æ¸ˆã¿åå‰
  issues: SanitizedIssue[];                // ã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆã¿å•é¡Œé…åˆ—
  rawOutput: string;                        // ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æ¸ˆã¿ç”Ÿå‡ºåŠ›
  executionTime: number;                    // å®Ÿè¡Œæ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰
  error?: string;                           // ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æ¸ˆã¿ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  sandboxId: string;                        // ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹è­˜åˆ¥å­
}
```

### SecureIterationResult (v2.0)

```typescript
interface SecureIterationResult {
  number: number;                           // åå¾©ç•ªå·
  timestamp: string;                        // ISO8601ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
  changedFiles: string[];                   // æ¤œè¨¼æ¸ˆã¿å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«
  issuesFixed: number;                      // ä¿®æ­£ã•ã‚ŒãŸå•é¡Œæ•°
  newIssues: SanitizedIssue[];             // æ–°è¦æ¤œå‡ºå•é¡Œ
}
```

### SecureMetrics (v2.0)

```typescript
interface SecureMetrics {
  totalExecutionTime: number;               // ç·å®Ÿè¡Œæ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰
  filesAnalyzed: number;                    // åˆ†æãƒ•ã‚¡ã‚¤ãƒ«æ•°
  issuesFound: number;                      // æ¤œå‡ºå•é¡Œæ•°
  issuesFixed: number;                      // ä¿®æ­£å•é¡Œæ•°
  
  // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¡ãƒˆãƒªã‚¯ã‚¹
  securityViolations: number;               // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é•åæ•°
  sanitizationEvents: number;               // ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œå›æ•°
  sandboxExecutions: number;                // ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹å®Ÿè¡Œæ•°
  cacheHits: number;                        // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆæ•°
  cacheMisses: number;                      // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒŸã‚¹æ•°
}
```

## ã‚¤ãƒ™ãƒ³ãƒˆ

v2.0ã§ã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’å«ã‚€åŒ…æ‹¬çš„ãªã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã‚’æä¾›ã—ã¾ã™ã€‚

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆ

#### security:violation

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é•åãŒæ¤œå‡ºã•ã‚ŒãŸã¨ã

```javascript
logger.security('SECURITY_VIOLATION', {
  type: 'path_traversal_attempt',
  input: sanitizedInput,
  blocked: true,
  timestamp: new Date().toISOString()
});
```

#### security:command_blocked

å±é™ºãªã‚³ãƒãƒ³ãƒ‰å®Ÿè¡ŒãŒé˜»æ­¢ã•ã‚ŒãŸã¨ã

```javascript
logger.security('COMMAND_BLOCKED', {
  command: attemptedCommand,
  reason: 'not_in_whitelist',
  source: 'user_input'
});
```

### ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¤ãƒ™ãƒ³ãƒˆ

#### agent:sandbox_created

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ãŒä½œæˆã•ã‚ŒãŸã¨ã

```javascript
logger.agent('sandbox_created', {
  agentId: agent.id,
  sandboxId: sandbox.id,
  resourceLimits: sandbox.resourceLimits
});
```

#### agent:execution_completed

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡ŒãŒå®Œäº†ã—ãŸã¨ã

```javascript
logger.agent(agent.name, 'execution_completed', {
  issuesFound: result.issues.length,
  executionTime: result.executionTime,
  sandboxId: result.sandboxId
});
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆ

#### performance:cache_hit

ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆãŒç™ºç”Ÿã—ãŸã¨ã

```javascript
logger.performance('cache_access', cacheAccessTime, {
  result: 'hit',
  agentId: agent.id,
  cacheKey: cacheKey.substring(0, 8)
});
```

#### performance:parallel_execution

ä¸¦åˆ—å®Ÿè¡Œã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹

```javascript
logger.performance('parallel_execution', totalTime, {
  agentsExecuted: results.length,
  successfulAgents: successfulResults.length,
  failedAgents: failedResults.length
});
```

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### ã‚»ã‚­ãƒ¥ã‚¢ã‚¨ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹

v2.0ã§ã¯ã€ã™ã¹ã¦ã®ã‚¨ãƒ©ãƒ¼ãŒè‡ªå‹•çš„ã«ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã•ã‚Œã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚°ã«è¨˜éŒ²ã•ã‚Œã¾ã™ã€‚

#### SanitizedError

```javascript
class SanitizedError extends Error {
  constructor(originalError) {
    const sanitized = SecurityUtils.sanitizeError(originalError);
    super(sanitized.message);
    this.code = sanitized.code;
    this.timestamp = sanitized.timestamp;
    this.sanitized = true;
  }
}
```

#### SecurityViolationError

```javascript
class SecurityViolationError extends SanitizedError {
  constructor(violation, details) {
    super(new Error(`Security violation: ${violation}`));
    this.violation = violation;
    this.details = SecurityUtils.sanitizeError(details);
  }
}
```

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³

#### åŒ…æ‹¬çš„ã‚¨ãƒ©ãƒ¼å‡¦ç†

```javascript
try {
  const result = await SecurityUtils.executeCommand('git', args);
  return result;
} catch (error) {
  const sanitized = SecurityUtils.sanitizeError(error);
  
  // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã¨ã—ã¦è¨˜éŒ²
  logger.security('COMMAND_EXECUTION_FAILURE', {
    command: 'git',
    error: sanitized.message,
    timestamp: sanitized.timestamp
  });
  
  throw new SanitizedError(error);
}
```

#### ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼å‡¦ç†

```javascript
// ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œã§ã®ã‚¨ãƒ©ãƒ¼å‡¦ç†
try {
  const result = await sandbox.execute(files, iteration);
  return result;
} catch (error) {
  return {
    agentId: agent.id,
    agentName: agent.name,
    issues: [],
    rawOutput: '',
    executionTime: 0,
    error: SecurityUtils.sanitizeError(error).message,
    sandboxId: sandbox.id
  };
}
```

## ä½¿ç”¨ä¾‹

### ä¾‹1: ã‚»ã‚­ãƒ¥ã‚¢ãªCI/CDã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

```javascript
const smartReviewV2 = require('./smart-review-v2');
const { StructuredLogger } = require('./lib/structured-logger');

async function secureCI() {
  const logger = new StructuredLogger();
  
  // ã‚»ã‚­ãƒ¥ã‚¢ãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä½œæˆ
  const secureContext = {
    files: createSecureFileSystem('./'),
    output: logger,
    terminal: createSandboxedTerminal()
  };
  
  // æ¤œè¨¼æ¸ˆã¿å¼•æ•°
  const args = {
    scope: 'changes',
    'max-iterations': 3,
    'priority-threshold': 'critical',
    'skip-comment': true
  };
  
  try {
    // ã‚»ã‚­ãƒ¥ã‚¢ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Ÿè¡Œ
    const result = await smartReviewV2.execute(secureContext, args);
    
    // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®ãƒã‚§ãƒƒã‚¯
    const criticalIssues = result.context.allIssues.filter(
      issue => issue.priority === 'critical'
    );
    
    if (criticalIssues.length > 0) {
      logger.security('CRITICAL_ISSUES_DETECTED', {
        count: criticalIssues.length,
        types: [...new Set(criticalIssues.map(i => i.type))]
      });
      
      // CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å¤±æ•—ã•ã›ã‚‹
      process.exit(1);
    }
    
    logger.info('ã‚»ã‚­ãƒ¥ã‚¢ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†', {
      issuesFound: result.context.metrics.issuesFound,
      securityViolations: result.context.metrics.securityViolations,
      executionTime: result.context.metrics.totalExecutionTime
    });
    
  } catch (error) {
    const sanitized = SecurityUtils.sanitizeError(error);
    logger.security('REVIEW_EXECUTION_FAILED', sanitized);
    process.exit(1);
  }
}
```

### ä¾‹2: ã‚«ã‚¹ã‚¿ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»

```javascript
const { AgentSandbox, SecurityUtils, ResultCache } = require('./smart-review-v2');

async function customSecurityAudit() {
  const cache = new ResultCache();
  const logger = new StructuredLogger();
  
  // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å°‚ç”¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­å®š
  const securityAgent = {
    id: 'custom-security-auditor',
    name: 'ã‚«ã‚¹ã‚¿ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»',
    model: 'opus',
    category: 'security',
    priority: 'critical',
    allowedCommands: ['git']
  };
  
  const targetFiles = await SecurityUtils.executeCommand('find', [
    '.', '-name', '*.js', '-type', 'f'
  ]);
  
  // ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆå‡¦ç†
  const validatedFiles = targetFiles.stdout
    .split('\n')
    .filter(f => f.trim())
    .map(f => SecurityUtils.validatePath(f))
    .slice(0, 1000); // ãƒ•ã‚¡ã‚¤ãƒ«æ•°åˆ¶é™
  
  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚§ãƒƒã‚¯
  const cached = await cache.get(securityAgent, validatedFiles, 1);
  if (cached) {
    logger.performance('cache_hit', 0, {
      agentId: securityAgent.id,
      fileCount: validatedFiles.length
    });
    return cached;
  }
  
  // ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹å®Ÿè¡Œ
  const sandbox = new AgentSandbox(securityAgent, secureContext);
  const result = await sandbox.execute(validatedFiles, 1);
  
  // çµæœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  await cache.set(securityAgent, validatedFiles, 1, result);
  
  // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é‡è¦åº¦åˆ¥é›†è¨ˆ
  const securitySummary = {
    critical: result.issues.filter(i => i.priority === 'critical').length,
    high: result.issues.filter(i => i.priority === 'high').length,
    types: [...new Set(result.issues.map(i => i.type))]
  };
  
  logger.security('SECURITY_AUDIT_COMPLETED', {
    filesAudited: validatedFiles.length,
    issuesFound: result.issues.length,
    summary: securitySummary,
    executionTime: result.executionTime
  });
  
  return {
    summary: securitySummary,
    issues: result.issues,
    executionTime: result.executionTime
  };
}
```

### ä¾‹3: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–

```javascript
class RealTimeSecurityMonitor {
  constructor() {
    this.logger = new StructuredLogger();
    this.cache = new ResultCache();
    this.alertThresholds = {
      critical: 0,  // Criticalå•é¡Œã¯å³åº§ã«ã‚¢ãƒ©ãƒ¼ãƒˆ
      high: 3,      // Highå•é¡ŒãŒ3å€‹ä»¥ä¸Šã§ã‚¢ãƒ©ãƒ¼ãƒˆ
      securityViolations: 5  // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é•åãŒ5å›ä»¥ä¸Šã§ã‚¢ãƒ©ãƒ¼ãƒˆ
    };
  }
  
  async monitorChanges() {
    setInterval(async () => {
      try {
        await this.performSecurityScan();
      } catch (error) {
        const sanitized = SecurityUtils.sanitizeError(error);
        this.logger.security('MONITORING_ERROR', sanitized);
      }
    }, 60000); // 1åˆ†é–“éš”
  }
  
  async performSecurityScan() {
    const result = await smartReviewV2.execute(secureContext, {
      scope: 'changes',
      'priority-threshold': 'high',
      'max-iterations': 1
    });
    
    // ã‚¢ãƒ©ãƒ¼ãƒˆæ¡ä»¶ãƒã‚§ãƒƒã‚¯
    const criticalIssues = result.context.allIssues.filter(
      i => i.priority === 'critical'
    );
    const highIssues = result.context.allIssues.filter(
      i => i.priority === 'high'
    );
    
    if (criticalIssues.length > this.alertThresholds.critical) {
      await this.sendSecurityAlert('CRITICAL_SECURITY_ISSUES', {
        count: criticalIssues.length,
        issues: criticalIssues.map(i => ({
          type: i.type,
          file: i.file,
          message: i.message
        }))
      });
    }
    
    if (highIssues.length > this.alertThresholds.high) {
      await this.sendSecurityAlert('HIGH_SECURITY_ISSUES', {
        count: highIssues.length,
        types: [...new Set(highIssues.map(i => i.type))]
      });
    }
    
    this.logger.security('SECURITY_SCAN_COMPLETED', {
      scanTime: result.context.metrics.totalExecutionTime,
      issuesFound: result.context.metrics.issuesFound,
      criticalCount: criticalIssues.length,
      highCount: highIssues.length
    });
  }
  
  async sendSecurityAlert(alertType, details) {
    this.logger.security('SECURITY_ALERT', {
      alertType,
      details,
      timestamp: new Date().toISOString(),
      severity: 'HIGH'
    });
    
    // å¤–éƒ¨ã‚¢ãƒ©ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ ã¸ã®é€šçŸ¥
    // await externalAlertSystem.notify(alertType, details);
  }
}

// ä½¿ç”¨ä¾‹
const monitor = new RealTimeSecurityMonitor();
await monitor.monitorChanges();
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. å…¥åŠ›æ¤œè¨¼ã®å¾¹åº•

```javascript
// ã™ã¹ã¦ã®å…¥åŠ›ã‚’æ¤œè¨¼ãƒ»ã‚µãƒ‹ã‚¿ã‚¤ã‚º
const validatedArgs = {
  scope: InputValidator.validateChoice(args.scope, ['changes', 'all']),
  target: SecurityUtils.validatePath(args.target),
  'max-iterations': InputValidator.validateNumber(args['max-iterations'], { 
    min: Config.MAX_ITERATIONS_RANGE.min, 
    max: Config.MAX_ITERATIONS_RANGE.max,
    integer: true
  }),
  'output-dir': SecurityUtils.validateOutputDirectory(args['output-dir']),
  'priority-threshold': InputValidator.validateChoice(args['priority-threshold'], 
    ['critical', 'high', 'medium', 'low'])
};
```

### 2. ã‚»ã‚­ãƒ¥ã‚¢ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ

```javascript
// ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆæ–¹å¼ã§ã®ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
const result = await SecurityUtils.executeCommand('git', gitArgs, {
  timeout: Config.COMMAND_TIMEOUT,
  maxBuffer: Config.MAX_BUFFER,
  cwd: SecurityUtils.validatePath(cwd),
  shell: false  // ã‚·ã‚§ãƒ«è§£é‡ˆã‚’ç„¡åŠ¹åŒ–
});
```

### 3. ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹åŒ–

```javascript
// ã™ã¹ã¦ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹å†…ã§å®Ÿè¡Œ
const sandbox = new AgentSandbox(agent, secureContext);
const result = await sandbox.execute(validatedFiles, iteration);

// çµæœã¯è‡ªå‹•çš„ã«ã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆã¿
logger.info('ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Œäº†', {
  agentId: result.agentId,
  issuesFound: result.issues.length,
  sandboxId: result.sandboxId
});
```

### 4. æ§‹é€ åŒ–ãƒ­ã‚°ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–

```javascript
// ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã®è¨˜éŒ²
logger.security('COMMAND_EXECUTION', {
  command: 'git',
  args: sanitizedArgs,
  success: true,
  executionTime: Date.now() - startTime
});

// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
logger.performance('agent_execution', executionTime, {
  agentType: agent.category,
  filesAnalyzed: files.length,
  issuesFound: result.issues.length
});
```

### 5. ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

```javascript
// ã‚»ã‚­ãƒ¥ã‚¢ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥ä½¿ç”¨
const cache = new ResultCache();
const cacheKey = await cache.getCacheKey(agent, validatedFiles, iteration);

// ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰ã®å®‰å…¨ãªå–å¾—
const cached = await cache.get(agent, validatedFiles, iteration);
if (cached) {
  logger.debug('ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆ', { 
    agentId: agent.id,
    cacheKey: cacheKey.substring(0, 8) + '...' // éƒ¨åˆ†è¡¨ç¤º
  });
  return cached;
}
```

### 6. ã‚¨ãƒ©ãƒ¼å‡¦ç†ã¨ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³

```javascript
// åŒ…æ‹¬çš„ãªã‚¨ãƒ©ãƒ¼å‡¦ç†
try {
  const result = await SecurityUtils.executeCommand(command, args, options);
  return result;
} catch (error) {
  const sanitized = SecurityUtils.sanitizeError(error);
  
  // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã¨ã—ã¦è¨˜éŒ²
  logger.security('COMMAND_EXECUTION_FAILURE', {
    command,
    error: sanitized.message,
    timestamp: sanitized.timestamp
  });
  
  throw new Error(sanitized.message);
}
```

### 7. ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™ã¨DDoSå¯¾ç­–

```javascript
// ä¸¦åˆ—å®Ÿè¡Œåˆ¶é™
const maxConcurrency = Math.min(agents.length, 4);
const results = await ParallelExecutor.executeAgents(
  agents.slice(0, maxConcurrency),
  validatedFiles,
  secureContext,
  iteration
);

// ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç›£è¦–
const memoryUsage = process.memoryUsage();
if (memoryUsage.heapUsed > Config.MAX_MEMORY) {
  logger.security('MEMORY_LIMIT_EXCEEDED', {
    heapUsed: memoryUsage.heapUsed,
    limit: Config.MAX_MEMORY
  });
  throw new Error('Memory limit exceeded');
}
```

---

*æœ€çµ‚æ›´æ–°: 2025-08-14*
*ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 2.0.1 - Security Enhanced Edition with Config Management*
*ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ“ãƒ¥ãƒ¼: å®Œäº†*
*ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹: OWASP Top 10 æº–æ‹ *
*è¨­å®šç®¡ç†: smart-review-config.jsãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¯¾å¿œ*