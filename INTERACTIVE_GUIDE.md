# Smart Review v2.0 - 対話式インターフェース完全ガイド

## 目次

1. [はじめに](#はじめに)
2. [対話式メニューの起動](#対話式メニューの起動)
3. [メインメニューの詳細](#メインメニューの詳細)
4. [カスタム設定モードの詳細ガイド](#カスタム設定モードの詳細ガイド)
5. [使用シナリオ別ガイド](#使用シナリオ別ガイド)
6. [トラブルシューティング](#トラブルシューティング)

## はじめに

Smart Review v2.0では、コマンドライン引数を覚える必要がない、直感的な対話式インターフェースを提供しています。初心者から上級者まで、誰でも簡単に高度なコードレビューを実行できます。

## 対話式メニューの起動

### 起動方法

対話式メニューを起動するには、オプションを指定せずにコマンドを実行します：

```bash
claude smart-review
```

### 起動時の画面

```
🔍 Smart Review v2.0 - 対話式メニュー

実行したい操作を選択してください:

1. 🔄 変更点のクイックレビュー
2. 🔍 プロジェクト全体のスキャン
3. 🛡️ セキュリティ監査
4. ⚡ 高優先度問題のみ
5. 🎯 カスタム設定
6. 📖 ヘルプ表示

[↑↓で移動、Enterで選択]
```

## メインメニューの詳細

### 1. 🔄 変更点のクイックレビュー

**概要**: 前回のチェック以降に変更されたファイルのみを素早くレビューします。

**内部設定**:
```javascript
{
  scope: 'changes',
  target: '.',
  'priority-threshold': 'medium',
  'max-iterations': 3
}
```

**実行される処理**:
1. Git差分を使用して変更ファイルを検出
2. 中優先度以上の問題を検出
3. 最大3回まで自動修正を試行
4. HTMLレポートとTODOリストを生成

**最適な使用場面**:
- 日常的な開発作業中
- プルリクエスト前のチェック
- コミット前の最終確認

### 2. 🔍 プロジェクト全体のスキャン

**概要**: プロジェクト全体を包括的にスキャンし、すべての問題を検出します。

**内部設定**:
```javascript
{
  scope: 'all',
  target: '.',
  'priority-threshold': 'medium',
  'max-iterations': 1
}
```

**実行される処理**:
1. プロジェクト内のすべてのファイルをスキャン
2. 4つのAIエージェントによる包括的分析
3. 中優先度以上の問題をすべて報告
4. 包括的なレポートを生成

**最適な使用場面**:
- プロジェクトの初回セットアップ時
- 大規模リファクタリング後
- 定期的な健全性チェック
- 新しいチームメンバーがプロジェクトに参加する時

### 3. 🛡️ セキュリティ監査

**概要**: セキュリティ脆弱性に特化した厳密な監査を実行します。

**内部設定**:
```javascript
{
  scope: 'all',
  target: '.',
  'priority-threshold': 'critical',
  'max-iterations': 2
}
```

**実行される処理**:
1. セキュリティエージェントを優先的に実行
2. XSS、SQLインジェクション、CSRF等を検出
3. 重大な脆弱性のみを報告
4. 自動修正を2回まで試行
5. セキュリティ特化型レポートを生成

**検出される脆弱性**:
- クロスサイトスクリプティング（XSS）
- SQLインジェクション
- コマンドインジェクション
- パストラバーサル
- 機密情報の露出
- 認証・認可の不備
- CSRF攻撃の可能性

**最適な使用場面**:
- プロダクションリリース前
- セキュリティ監査要件への対応
- ペネトレーションテスト前の自己診断

### 4. ⚡ 高優先度問題のみ

**概要**: 重要度の高い問題に絞って効率的にレビューします。

**内部設定**:
```javascript
{
  scope: 'changes',
  target: '.',
  'priority-threshold': 'high',
  'max-iterations': 5
}
```

**実行される処理**:
1. 変更ファイルのみをチェック
2. Critical/High優先度の問題のみを検出
3. 最大5回まで自動修正を積極的に試行
4. 簡潔なレポートを生成

**最適な使用場面**:
- 時間が限られている場合
- ホットフィックスの検証
- 重要な問題のみに集中したい場合

### 5. 🎯 カスタム設定

**概要**: すべての設定項目を個別に指定できる詳細設定モードです。

**選択後の流れ**: 以下のセクションで詳しく説明します。

### 6. 📖 ヘルプ表示

**概要**: 詳細なヘルプメッセージとオプション一覧を表示します。

**表示される内容**:
- 全オプションの詳細説明
- 使用例
- 機能一覧
- トラブルシューティングのヒント

## カスタム設定モードの詳細ガイド

### ステップ1: チェック範囲の選択

```
========================================
📋 チェック範囲を選択してください
========================================

どの範囲をレビューしますか？

  > 変更点のみ (changes)
    プロジェクト全体 (all)

[↑↓で選択、Enterで決定]
```

**選択肢の詳細**:

- **変更点のみ (changes)**
  - Gitを使用して前回チェック以降の変更を検出
  - 高速で効率的
  - 自動修正の反復実行が可能
  
- **プロジェクト全体 (all)**
  - すべてのファイルをスキャン
  - 包括的だが時間がかかる
  - 初回実行時推奨

### ステップ2: 対象ディレクトリの入力

```
========================================
📁 対象ディレクトリを指定
========================================

レビュー対象のディレクトリを入力してください
（相対パスまたは絶対パス）

対象ディレクトリ [デフォルト: .]: 
> ./src
```

**入力例**:
- `.` - カレントディレクトリ（デフォルト）
- `./src` - srcディレクトリ
- `./components` - componentsディレクトリ
- `/home/user/project` - 絶対パス

**ヒント**:
- Enterキーのみでデフォルト値を使用
- タブ補完が利用可能（環境による）

### ステップ3: 優先度しきい値の選択

```
========================================
🎯 優先度しきい値の設定
========================================

どのレベルの問題まで検出しますか？

    重大な問題のみ (critical)
  > 高優先度以上 (high)
    中優先度以上 (medium)
    すべての問題 (low)

[↑↓で選択、Enterで決定]
```

**優先度レベルの説明**:

| レベル | 含まれる問題 | 推定対応時間 |
|--------|-------------|-------------|
| **critical** | セキュリティ脆弱性、データ損失リスク | 即座に対応必要 |
| **high** | 重大なバグ、パフォーマンス問題 | 1-2時間以内 |
| **medium** | コード品質、軽微なバグ | 1日以内 |
| **low** | スタイル、ドキュメント | 時間がある時 |

### ステップ4: 最大繰り返し回数の入力

**注意**: このステップは`changes`モードを選択した場合のみ表示されます。

```
========================================
🔄 自動修正の設定
========================================

自動修正を何回まで試行しますか？
（1-10の範囲で入力）

最大繰り返し回数 [デフォルト: 5]: 
> 3
```

**繰り返し回数の目安**:
- `1-2`: 軽微な修正のみ
- `3-5`: 標準的な修正（推奨）
- `6-10`: 積極的な修正

### ステップ5: コメント注釈のスキップ確認

```
========================================
💬 コメント注釈の設定
========================================

日本語コメント注釈を追加しますか？
（CI環境では'y'を推奨）

コメント注釈をスキップしますか? (y/N): 
> n
```

**選択肢**:
- **N (いいえ)**: コメント注釈を実行（デフォルト）
  - コードに日本語の説明コメントを追加
  - 理解しやすさが向上
  
- **Y (はい)**: コメント注釈をスキップ
  - CI/CD環境で推奨
  - 実行時間を短縮

### ステップ6: 出力ディレクトリの入力

```
========================================
📊 レポート出力先の設定
========================================

レポートファイルの保存先を指定してください

出力ディレクトリ [デフォルト: ./smart-review-results]: 
> ./reports/2024-01
```

**出力されるファイル**:
```
指定ディレクトリ/
├── report-[timestamp].html      # HTMLレポート
├── report-[timestamp].md        # Markdownレポート  
├── todo-[timestamp].md          # TODOリスト
├── metrics.json                 # メトリクスデータ
└── raw-output/                  # 生のエージェント出力
    ├── security-analyzer.txt
    ├── bug-detector.txt
    ├── code-reviewer.txt
    └── doc-updater.txt
```

## 使用シナリオ別ガイド

### シナリオ1: 新規プロジェクトの初期レビュー

1. メインメニューで「2. 🔍 プロジェクト全体のスキャン」を選択
2. レビュー完了後、生成されたTODOリストを確認
3. 重要な問題から順に対応

### シナリオ2: 日常的な開発作業

1. コミット前に `claude smart-review` を実行
2. 「1. 🔄 変更点のクイックレビュー」を選択
3. 自動修正された問題を確認
4. 残った問題を手動で修正

### シナリオ3: プルリクエスト前の品質チェック

1. メインメニューで「5. 🎯 カスタム設定」を選択
2. 範囲: `changes`
3. 優先度: `high`
4. 繰り返し: `5`
5. コメント: スキップしない
6. レポートを確認してPRに添付

### シナリオ4: セキュリティ重視のリリース前チェック

1. 「3. 🛡️ セキュリティ監査」を選択
2. 完了後、criticalな問題がないことを確認
3. セキュリティレポートを監査証跡として保存

### シナリオ5: CI/CDパイプライン統合

コマンドラインで直接実行（対話式メニューを使用しない）:
```bash
claude smart-review \
  --scope changes \
  --priority-threshold high \
  --skip-comment \
  --max-iterations 3
```

## トラブルシューティング

### Q: メニューが文字化けする

**A**: ターミナルのエンコーディングをUTF-8に設定してください。

```bash
# Windowsの場合
chcp 65001

# macOS/Linuxの場合
export LANG=ja_JP.UTF-8
```

### Q: 選択ができない / 矢印キーが効かない

**A**: お使いのターミナルエミュレータが対話式入力をサポートしているか確認してください。以下のターミナルを推奨：
- Windows Terminal
- iTerm2 (macOS)
- VS Code統合ターミナル

### Q: カスタム設定の途中でキャンセルしたい

**A**: `Ctrl+C`でいつでも中断できます。設定は保存されません。

### Q: デフォルト設定を変更したい

**A**: 環境変数で設定可能です：

```bash
export SMART_REVIEW_DEFAULT_SCOPE=all
export SMART_REVIEW_DEFAULT_PRIORITY=high
export SMART_REVIEW_DEFAULT_OUTPUT=./my-reports
```

### Q: 実行時間が長すぎる

**A**: 以下の対策を試してください：
1. スコープを`changes`に限定
2. 優先度しきい値を`high`または`critical`に設定
3. 特定のディレクトリのみをターゲットに指定
4. `--skip-comment`オプションを使用

### Q: エラーが発生した場合

**A**: 以下の情報と共に問題を報告してください：
- 選択したメニューオプション
- 各ステップで入力した値
- エラーメッセージの全文
- `smart-review-results/`ディレクトリ内のログファイル

## まとめ

Smart Review v2.0の対話式インターフェースは、複雑なコマンドラインオプションを覚える必要なく、直感的な操作で高度なコードレビューを実行できるように設計されています。

初めて使用する場合は、まず「📖 ヘルプ表示」で全体像を把握し、その後「🔄 変更点のクイックレビュー」から始めることをお勧めします。

より詳細な制御が必要な場合は、「🎯 カスタム設定」を使用して、プロジェクトの要件に合わせた最適な設定でレビューを実行してください。

---

*Smart Review v2.0 - Intelligent Code Review Automation System*
*最終更新: 2024年*